<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APS Computer Science</title>
    <link rel="stylesheet" href="css/style.css"> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js" integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

        document.addEventListener("DOMContentLoaded", () => {
            // Initialize Mermaid with startOnLoad set to false
            mermaid.initialize({ startOnLoad: false });

            // Initial Mermaid graph definition
            let mainGraph = `
        subgraph Recommended Start
            F[Intro to IT]
            click F it_desc
        end
        
        subgraph Standard Path
            F --> B[Programming]
            click B call load_md_course("md/prog.md")
            B --> G[Computer Programming Advanced]
            click G call load_md_course("md/advprog.md")
            G --> H[AP CS A]
            click H call load_md_course("md/apcsa.md")
        end`;

    let feeders = `
        subgraph Optional Feeder Classes
            C[AP CS Principles]
            click C call load_md_course("md/apcsp.md")
            E[Game Design]
            click E call load_md_course("md/game.md")
            O[Robotics]
            click O call load_md_course("md/robo.md")
        end 
        
        C --> G
        E --> B
        O --> B
    `

    let accgraph = `
            subgraph Courses only at ACC
                subgraph NOVA CS Associates
                    D[Web Page Design]
                    click D call load_md_course("md/web.md")
                    D --> I[DE Computer Programming] 
                    click I call load_md_course("md/de_prog_1.md")
                    H --> J
                    I --> J[DE Computer Programming Intensified]
                    click J call load_md_course("md/de_prog_2.md")
                    J --> K[DE Computer Programming Advanced]
                    click K call load_md_course("md/de_prog_3.md")
                end
                subgraph NOVA Web Certificate
                    J --> L[Database Design & Management]
                    click L call load_md_course("md/db.md")
                end
            
            end
            `;

            let ibgraph = `
            subgraph Courses only at WLHS
                M[IB CS SL/HL I] --> N[IB CS HL II]
                click M call load_md_course("md/ib_1.md")
                click N call load_md_course("md/ib_2.md")
                B --> M
                H --> N
            end
            `

            // initialize the variable where we build the graph
            // and an array to store added nodes (so we can track if they exist)
            let graphDefinition = mainGraph;
            let addedNodes = ['main'];

            // Function to render the graph
            function renderGraph() {
                graphDefinition = `graph TD

                subgraph Courses at Home Schools
                `;
                
                if (addedNodes.includes('main')) {
                    graphDefinition += mainGraph;
                }
                if (addedNodes.includes('feeders')){
                    graphDefinition += feeders;
                }
                graphDefinition += `
                end
                `
                if (addedNodes.includes('acc')){
                    graphDefinition += accgraph;
                }
                if (addedNodes.includes('ib')){
                    graphDefinition += ibgraph;
                }
                
                
                document.getElementById("graph-container").innerHTML = `<div class="mermaid">${graphDefinition}</div>`;
                mermaid.init({
                    securityLevel: 'loose',
                });
            }
                   
            window.load_md_course = function(file){
                fetch(file)
                //.then(res => response.)
                .then(response => {
                    if (!response.ok) {
                    // If the file is not found (status 404), throw an error
                    throw new Error('File not found');
                    }
                    return response.text();
                })
                .then(mdContent => {
                showdown.setOption('tables','true');
                var conv = new showdown.Converter();
                var md_html = conv.makeHtml(mdContent);
                document.getElementById('courseDescription').innerHTML = md_html;
                })
                .catch(error => {
                    console.log(error);
                    document.getElementById('courseDescription').innerHTML = 'Sorry, this course does not have a description yet!';
                });
            }

            // Render the initial graph
            renderGraph();

            //setup toggle button behavior
            document.getElementById("toggleACC").addEventListener("click", (event) => {
                if (!addedNodes.includes('acc')) {
                    addedNodes.push('acc');
                    event.target.classList.add('active');
                } else {
                    addedNodes = addedNodes.filter(node => node !== 'acc');
                    event.target.classList.remove('active');
                }
                renderGraph();
            });

            document.getElementById("toggleIB").addEventListener("click", (event) => {
                if (!addedNodes.includes('ib')) {
                    addedNodes.push('ib');
                    event.target.classList.add('active');
                } else {
                    addedNodes = addedNodes.filter(node => node !== 'ib');
                    event.target.classList.remove('active');
                }
                renderGraph();
            });

            document.getElementById("toggleFeeders").addEventListener("click", (event) => {
                if (!addedNodes.includes('feeders')) {
                    addedNodes.push('feeders');
                    event.target.classList.add('active');
                } else {
                    addedNodes = addedNodes.filter(node => node !== 'feeders');
                    event.target.classList.remove('active');
                }
                renderGraph();
            });

        });
    </script>
</head>
<body>
    <header>
    <h2>APS CS Courses</h2>
    <p>This page is a work in progress. Its content is under review, and it should not (yet) be used for any official decision making</p>
    </header>
    
    <div id="graph-container"></div>

    <div id="toggles">
        <h2>Use these buttons to show/hide additional courses</h2>
        <button id="toggleFeeders">Optional Home School Classes</button>
        <button id="toggleACC">ACC Classes</button>
        <button id="toggleIB">IB Classes</button>
    </div>
    <div id="description">
        
        <div id="courseDescription">
            <h2>Click a course name to see its description</h2>
        </div>
    </div>
    <footer>
        <p>This site is maintained by APS's CS Teacher PLC. It contains informal and unofficial advice. For official guidance, see the APS Program of Studies or contact the CTE Office.
            <br>
        Advanced students often skip classes in these sequences. Contact course instructors for advice about placement in course sequences other than this page.</p>
    </footer>
</body>
</html>
